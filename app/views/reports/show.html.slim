- title @report.title

header.page-header
  .container
    .page-header__inner
      .page-header__title
        | #{l @report.reported_on} ã®æ—¥å ±
      .page-header-actions
        ul.page-header-actions__items
          li.page-header-actions__item
            = link_to new_report_path, class: 'a-button is-md is-secondary is-block' do
              i.fa-regular.fa-plus
              | æ—¥å ±ä½œæˆ
          li.page-header-actions__item
            = link_to reports_path, class: 'a-button is-md is-secondary is-block is-back' do
              | æ—¥å ±ä¸€è¦§

- if mentor_login? && !@report.first? && @report.latest_of_user?
  .a-page-notice.is-only-mentor(class="#{@report.interval >= 10 ? 'is-danger' : ''}")
    .container
      .a-page-notice__inner
        p
          strong
            | #{@report.interval}æ—¥
          | ã¶ã‚Šã®æ—¥å ±ã§ã™

.page-body
  .container.is-xxxl
    .row.is-jc:c
      .col-xl-7.col-xs-12
        .report.page-content
          header.page-content-header
            #js-check-stamp(data-checkable-id="#{@report.id}" data-checkable-type='Report')
            .page-content-header__start
              .page-content-header__user
                = render 'users/icon', user: @report.user, link_class: 'page-content-header__user-link', image_class: 'page-content-header__user-icon'
              - if @report.user.trainee?
                = link_to company_path(@report.user.company) do
                  = image_tag @report.user.company.logo_url, class: 'page-content-header__company-logo'
            .page-content-header__end
              .page-content-header__row
                .page-content-header__before-title
                  = link_to @report.user, class: 'a-user-name' do
                    = @report.user.long_name
                h1.page-content-header__title(class="#{@report.wip? ? 'is-wip' : ''}")
                  - if @report.emotion.present?
                    span.page-content-header__emotion
                      = image_tag Report.faces[@report.emotion], id: @report.emotion, alt: @report.emotion, class: 'page-content-header__emotion-image'
                  - if @report.wip?
                    span.a-title-label.is-wip
                      | WIP
                  | #{@report.title}

              .page-content-header__row
                .page-content-header-metas
                  .page-content-header-metas__start
                    .page-content-header-metas__meta
                      .a-meta
                        = l @report.reported_on
                        | ï¼ˆ
                        span.a-meta__count(class="#{@report.serial_number < 6 ? 'is-important' : ''}")
                          = @report.number
                        | ï¼‰
                        = 'ã®æ—¥å ±' unless @report.first?
                        - if @report.published_at.present?
                          .a-meta
                            | ï¼ˆ#{l @report.published_at} æå‡ºï¼‰

                  .page-content-header-metas__end
                    .page-content-header-metas__meta
                      - length = @report.comments.length
                      a.a-meta(href='#comments' class="#{length.zero? ? 'is-disabled' : ''}")
                        | ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ
                        span(class="#{length.zero? ? 'is-muted' : 'is-emphasized'}")
                          = length
                        | ï¼‰

              .page-content-header__row
                .page-content-header-actions
                  .page-content-header-actions__start
                    .page-content-header-actions__action
                      #js-watch-toggle(data-watchable-id="#{@report.id}", data-watchable-type='Report')
                    .page-content-header-actions__action
                      #js-bookmark(data-bookmarkable-id="#{@report.id}", data-bookmarkable-type='Report')
                  .page-content-header-actions__end
                    - if @report.user_id == current_user.id
                      .page-content-header-actions__action
                        = link_to new_report_path(id: @report), class: 'a-button is-sm is-secondary is-block', id: 'copy' do
                          i.fa-solid.fa-copy
                          | ã‚³ãƒ”ãƒ¼
                    .page-content-header-actions__action
                      = link_to 'Raw', report_path(format: :md), class: 'a-button is-sm is-secondary is-block', target: '_blank', rel: 'noopener'

              - if @report.practices.present?
                .page-content-header__row
                  .page-content-header__tags
                    .tag-links
                      ul.tag-links__items
                        - @report.practices.eager_load(:categories).order('categories_practices.position').each do |practice|
                          li.tag-links__item
                            = link_to practice, class: 'tag-links__item-link' do
                              = practice.title

          .a-card
            .card-header.is-sm
              = render 'reports/learning_times', report: @report
            .card-body
              .card__description
                .a-long-text.is-md.js-markdown-view(data-taskable-id="#{@report.id}" data-taskable-type='Report' data-taskable="#{@report.taskable?(current_user).to_s}")
                  = @report.description
            = render 'reactions/reactions', reactionable: @report

            - if @report.user_id == current_user.id
              .card-footer
                .card-main-actions
                  ul.card-main-actions__items
                    li.card-main-actions__item
                      = link_to edit_report_path(@report), class: 'card-main-actions__action a-button is-sm is-secondary is-block', id: 'js-shortcut-edit' do
                        i.fa-solid.fa-pen#new
                        | å†…å®¹ä¿®æ­£
                    li.card-main-actions__item.is-sub
                      = link_to report_path(@report), data: { confirm: 'æœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ' }, method: :delete, class: 'card-main-actions__muted-action' do
                        span#delete
                          | å‰Šé™¤ã™ã‚‹

            - if admin_or_mentor_login?
              #js-check(data-checkable-id="#{@report.id}" data-checkable-type='Report' data-checkable-label="#{Report.model_name.human}")

          .page-content-prev-next
            .page-content-prev-next__item
              - if @report.previous
                = link_to @report.previous, class: 'page-content-prev-next__item-link is-prev' do
                  i.fa-solid.fa-angle-left
                  | å‰ã®æ—¥å ±
            .page-content-prev-next__item
              = link_to user_reports_path(@report.user_id), class: 'page-content-prev-next__item-link is-index' do
                | æ—¥å ±ä¸€è¦§
            .page-content-prev-next__item
              - if @report.next
                = link_to @report.next, class: 'page-content-prev-next__item-link is-next' do
                  | æ¬¡ã®æ—¥å ±
                  i.fa-solid.fa-angle-right

        #js-comments(data-commentable-id="#{@report.id}" data-commentable-type='Report' data-current-user-id="#{current_user.id}")

        div(data-vue='Footprints' data-vue-footprintable-id="#{@report.id}" data-vue-footprintable-type='Report')

      .col-xl-5.col-xs-12
        - if current_user.mentor? || current_user.admin?
          .side-tabs
            input.a-toggle-checkbox#side-tabs-1 type='radio' name='side-tabs-contents' checked='checked'
            input.a-toggle-checkbox#side-tabs-2 type='radio' name='side-tabs-contents'
            input.a-toggle-checkbox#side-tabs-3 type='radio' name='side-tabs-contents'
            .side-tabs-nav.is-only-mentor
              .side-tabs-nav__items
                .side-tabs-nav__item
                  label.side-tabs-nav__item-link#side-tabs-nav-1 for='side-tabs-1'
                    | ç›´è¿‘ã®æ—¥å ±
                .side-tabs-nav__item
                  label.side-tabs-nav__item-link#side-tabs-nav-2 for='side-tabs-2'
                    | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ¢
                .side-tabs-nav__item
                  label.side-tabs-nav__item-link#side-tabs-nav-3 for='side-tabs-3'
                    | æå‡ºç‰©
            .side-tabs-contents
              .side-tabs-contents__item#side-tabs-content-1
                div(data-vue="Reports" data-vue-user-id:number="#{@report.user.id}" data-vue-limit="10" data-vue-display-user-icon:boolean="false")
              .side-tabs-contents__item#side-tabs-content-2.is-only-mentor
                .user-info
                  = render 'users/user_secret_attributes', user: @report.user
                  = render 'users/metas', user: @report.user
                #js-user-mentor-memo(data-user-id='#{@report.user_id}')
              .side-tabs-contents__item#side-tabs-content-3.is-only-mentor
                .card-list.a-card
                  - if @products.present?
                    - @products.each do |product|
                      = render partial: 'product', locals: { product: product }
                  - else
                    .card-list__message
                      .container
                        .o-empty-message
                          .o-empty-message__icon
                            i.fa-regular.fa-sad-tear
                          .o-empty-message__text
                            | æå‡ºç‰©ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚
        - else
          div(data-vue="Reports" data-vue-user-id:number="#{@report.user.id}" data-vue-limit="10" data-vue-display-user-icon:boolean="false")

- if flash[:notify_help] && flash[:celebrate_report_count]
    = render '/shared/modal', id: 'modal-notify-help', modal_title: 'ğŸ‰ ãŠã‚ã§ã¨ã†ï¼', auto_show: true
      .modal__description
        = render 'celebrate_report_count_body'
      .modal__description.is-md
        = render 'notify_help_body'
- elsif flash[:notify_help]
    = render '/shared/modal', id: 'modal-notify-help', modal_title: 'ğŸµ ä»Šæ—¥ã‚‚å­¦ç¿’ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼', auto_show: true
      .modal__description.is-md
        = render 'notify_help_body'
- elsif flash[:celebrate_report_count]
    = render '/shared/modal', id: 'modal-report-counts-celebration', modal_title: 'ğŸ‰ ãŠã‚ã§ã¨ã†ï¼', auto_show: true
      .modal__description
        = render 'celebrate_report_count_body'
